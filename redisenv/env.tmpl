---

# docker-compose version 3 does not support ipv6
version: "2.1"
{% if ipv6 %}
networks:
    ip6net:
        name: {{name}}_ipv6net
        enable_ipv6: true
{% endif %}

services:
    {% for n in range(nodes) %}
    redis{{n+1}}:
        image: {{image}}:{{version}}
        ports:
            - "{{ports[n]}}:{{listening_port}}"
        {% for m in mounts %}
        volumes:
            - {{m['local']}}:{{m['remote']}}
        {% endfor %}
        {% if conffile != none %}
            - {{conffile}}:/usr/local/etc/redis/redis.conf
        {% endif %}

        {% if ipv6 %}
        networks:
            - {{name}}_ipv6net
        {% endif %}
        {% if redisoptions|length != 0 %} 
        command: redis-server {{ redisoptions[n] }}
        {% endif %}
    {% endfor%}